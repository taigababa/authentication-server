<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>OAuth Result</title>
    <style>
      :root {
        color-scheme: light dark;
        --bg-light: #f2f5ff;
        --bg-dark: #070715;
        --card-bg: rgba(255, 255, 255, 0.7);
        --card-border: rgba(255, 255, 255, 0.55);
        --accent: #00f2ea;
        --accent-strong: #ff0050;
        --body: #12111d;
        --muted: #68657a;
      }

      @media (prefers-color-scheme: dark) {
        :root {
          --bg-light: #05050d;
          --bg-dark: #05020a;
          --card-bg: rgba(13, 13, 24, 0.78);
          --card-border: rgba(255, 255, 255, 0.12);
          --body: #f5f4ff;
          --muted: #9e9ab8;
        }
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        line-height: 1.65;
        color: var(--body);
        background: radial-gradient(circle at top left, var(--bg-light), var(--bg-dark));
        display: flex;
        flex-direction: column;
      }

      .page {
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      header {
        padding: clamp(2.5rem, 6vw, 5rem) clamp(1.5rem, 6vw, 5rem) clamp(1rem, 4vw, 2rem);
      }

      .hero {
        max-width: 960px;
        margin: 0 auto;
        display: grid;
        gap: 1.4rem;
      }

      .hero__status {
        display: inline-flex;
        align-items: center;
        gap: 0.65rem;
        padding: 0.5rem 1rem;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.18);
        border: 1px solid var(--card-border);
        backdrop-filter: blur(16px);
        font-weight: 600;
      }

      .hero__status-dot {
        width: 0.55rem;
        height: 0.55rem;
        border-radius: 50%;
        background: var(--accent);
        box-shadow: 0 0 0 4px rgba(0, 242, 234, 0.18);
      }

      h1 {
        margin: 0;
        font-size: clamp(2rem, 4vw, 3rem);
        letter-spacing: -0.01em;
      }

      .hero__lead {
        margin: 0;
        max-width: 620px;
        color: var(--muted);
        font-size: 1rem;
      }

      main {
        flex: 1;
        padding: 0 clamp(1.5rem, 6vw, 5rem) clamp(4rem, 7vw, 6rem);
      }

      .layout {
        max-width: 960px;
        margin: 0 auto;
        display: grid;
        gap: clamp(1.75rem, 3vw, 2.5rem);
      }

      .card {
        border-radius: 28px;
        border: 1px solid var(--card-border);
        background: var(--card-bg);
        backdrop-filter: blur(22px);
        box-shadow: 0 24px 60px rgba(15, 12, 35, 0.16);
        padding: clamp(1.8rem, 4vw, 2.6rem);
      }

      .card--split {
        display: grid;
        gap: 1.6rem;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        align-items: center;
      }

      .profile {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .avatar {
        width: 68px;
        height: 68px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid rgba(255, 255, 255, 0.65);
        box-shadow: 0 0 0 6px rgba(0, 0, 0, 0.08);
      }

      .avatar--fallback {
        display: grid;
        place-items: center;
        background: rgba(0, 0, 0, 0.1);
        color: var(--muted);
        font-weight: 700;
        font-size: 1.4rem;
      }

      .profile__meta {
        display: grid;
        gap: 0.35rem;
      }

      .profile__label {
        text-transform: uppercase;
        font-size: 0.75rem;
        letter-spacing: 0.12em;
        color: var(--muted);
      }

      .profile__name {
        font-size: 1.3rem;
        font-weight: 700;
      }

      .badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.4rem 0.8rem;
        border-radius: 999px;
        background: rgba(0, 0, 0, 0.08);
        color: var(--muted);
        font-size: 0.85rem;
      }

      .tokens {
        display: grid;
        gap: clamp(1.4rem, 3vw, 2rem);
      }

      .token {
        position: relative;
        padding: 1.4rem 1.4rem 1.2rem;
        border-radius: 20px;
        border: 1px solid rgba(15, 12, 35, 0.08);
        background: rgba(255, 255, 255, 0.82);
        box-shadow: 0 18px 44px rgba(15, 12, 35, 0.12);
      }

      .token__label {
        margin: 0 0 0.55rem;
        font-size: 0.85rem;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: rgba(15, 12, 35, 0.6);
      }

      .token__value {
        margin: 0;
        font-family: "JetBrains Mono", "SFMono-Regular", SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        font-size: 0.9rem;
        word-break: break-all;
        color: rgba(15, 12, 35, 0.86);
      }

      .token__meta {
        margin-top: 0.75rem;
        font-size: 0.8rem;
        color: rgba(15, 12, 35, 0.58);
      }

      .card--note {
        border-style: dashed;
        border-color: rgba(255, 255, 255, 0.45);
        background: rgba(10, 10, 30, 0.5);
        color: rgba(245, 244, 255, 0.9);
      }

      .note__title {
        margin: 0 0 0.8rem;
        font-size: 1.05rem;
        font-weight: 600;
      }

      .note__list {
        margin: 0;
        padding-left: 1.1rem;
        font-size: 0.95rem;
        line-height: 1.7;
      }

      .insights {
        display: grid;
        gap: 1.2rem;
      }

      .insights__header {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
      }

      .insights__header h2 {
        margin: 0;
        font-size: 1.35rem;
      }

      .insights__meta {
        font-size: 0.85rem;
        color: var(--muted);
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
      }

      .insights__meta code {
        background: rgba(15, 12, 35, 0.08);
        padding: 0.1rem 0.4rem;
        border-radius: 6px;
        font-size: 0.8rem;
      }

      .insights__grid {
        display: grid;
        gap: 1.4rem;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      }

      .video-card {
        border-radius: 18px;
        overflow: hidden;
        border: 1px solid rgba(15, 12, 35, 0.08);
        background: rgba(255, 255, 255, 0.85);
        box-shadow: 0 18px 40px rgba(15, 12, 35, 0.12);
        display: flex;
        flex-direction: column;
      }

      .video-card__thumb {
        width: 100%;
        aspect-ratio: 9 / 16;
        object-fit: cover;
      }

      .video-card__body {
        padding: 1rem 1.2rem 1.2rem;
        display: grid;
        gap: 0.45rem;
      }

      .video-card__title {
        margin: 0;
        font-weight: 600;
        font-size: 1rem;
      }

      .video-card__id {
        margin: 0;
        font-family: "JetBrains Mono", "SFMono-Regular", SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        font-size: 0.8rem;
        color: rgba(15, 12, 35, 0.58);
        word-break: break-all;
      }

      .video-card__meta {
        margin: 0;
        font-size: 0.85rem;
        color: var(--muted);
      }

      .video-card__stats {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.35rem;
      }

      .stat-chip {
        display: inline-flex;
        align-items: center;
        gap: 0.3rem;
        padding: 0.35rem 0.6rem;
        border-radius: 999px;
        font-size: 0.75rem;
        background: rgba(15, 12, 35, 0.08);
        color: rgba(15, 12, 35, 0.7);
      }

      .stat-chip__label {
        font-weight: 600;
        letter-spacing: 0.03em;
      }

      .insights__empty {
        margin: 0;
        font-size: 0.95rem;
        color: var(--muted);
      }

      .table-section {
        display: grid;
        gap: 1rem;
      }

      .metrics-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.93rem;
      }

      .metrics-table th,
      .metrics-table td {
        padding: 0.75rem 1rem;
        text-align: left;
        border-bottom: 1px solid rgba(15, 12, 35, 0.08);
        color: rgba(15, 12, 35, 0.82);
      }

      .metrics-table tbody tr:last-child td {
        border-bottom: none;
      }

      .metrics-table th {
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: rgba(15, 12, 35, 0.7);
        background: rgba(15, 12, 35, 0.06);
      }

      .metrics-table__numeric {
        font-family: "JetBrains Mono", "SFMono-Regular", SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        font-size: 0.88rem;
      }

      .metrics-table__thumb {
        width: 54px;
        height: 54px;
        object-fit: cover;
        border-radius: 12px;
      }

      .actions {
        margin-top: 1.6rem;
      }

      .back-link {
        display: inline-flex;
        align-items: center;
        gap: 0.45rem;
        text-decoration: none;
        font-weight: 600;
        color: var(--accent-strong);
      }

      .back-link:hover,
      .back-link:focus-visible {
        text-decoration: underline;
      }

      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
          scroll-behavior: auto !important;
        }
      }
    </style>
  </head>
  <body>
    <div class="page">
      <header>
        <div class="hero">
          <div class="hero__status">
            <span class="hero__status-dot" aria-hidden="true"></span>
            認証フローが完了しました
          </div>
          <h1>トークン取得に成功しました</h1>
          <p class="hero__lead">
            TikTok から返却されたユーザー情報とトークンを確認できます。安全な場所に保管し、不要になったトークンは速やかに失効させてください。
          </p>
        </div>
      </header>

      <main>
        <div class="layout">
          <section class="card card--split" aria-labelledby="profile">
            <div class="profile">
              {{if .AvatarURL}}
              <img class="avatar" src="{{.AvatarURL}}" alt="avatar">
              {{else}}
              <div class="avatar avatar--fallback" aria-hidden="true">?</div>
              {{end}}
              <div class="profile__meta">
                <span class="profile__label" id="profile">Display Name</span>
                <span class="profile__name">{{if .DisplayName}}{{.DisplayName}}{{else}}(不明){{end}}</span>
                <span class="badge">TikTok OAuth</span>
              </div>
            </div>
          </section>

          <section class="card tokens" aria-labelledby="tokens">
            <h2 id="tokens" style="margin: 0 0 1.2rem; font-size: 1.35rem;">認証トークン</h2>
            <article class="token">
              <div class="token__label">ACCESS TOKEN</div>
              <p class="token__value">{{.AccessToken}}</p>
              <p class="token__meta">API リクエストで使用します。漏洩した場合は即時に revoke してください。</p>
            </article>
            <article class="token">
              <div class="token__label">REFRESH TOKEN</div>
              <p class="token__value">{{.RefreshToken}}</p>
              <p class="token__meta">長期的な再認証に利用します。安全なストレージで暗号化して保管しましょう。</p>
            </article>
          </section>

          <section class="card insights" aria-labelledby="insights-detailed-title">
            <div class="insights__header">
              <h2 id="insights-detailed-title">投稿動画一覧</h2>
            </div>
            <div class="insights__grid" id="insights-detailed-grid" aria-live="polite"></div>
            <p class="insights__empty" id="insights-detailed-empty">データを取得しています…</p>
          </section>

          <section class="card table-section" aria-labelledby="insights-table-title">
            <div class="insights__header">
              <h2 id="insights-table-title">動画パフォーマンス表</h2>
            </div>
            <div class="table-wrapper" style="overflow-x: auto;">
              <table class="metrics-table" aria-describedby="insights-table-title insights-table-caption">
                <thead>
                  <tr>
                    <th scope="col">サムネイル</th>
                    <th scope="col">タイトル</th>
                    <th scope="col">再生時間</th>
                    <th scope="col">再生数</th>
                    <th scope="col">いいね数</th>
                    <th scope="col">コメント数</th>
                    <th scope="col">シェア数</th>
                  </tr>
                </thead>
                <tbody id="insights-table-body">
                  <tr>
                    <td colspan="7" style="padding: 1rem; text-align: center; color: var(--muted);">
                      データを読み込んでいます…
                    </td>
                  </tr>
                </tbody>
              </table>
              <p id="insights-table-caption" style="margin: 0.25rem 0 0; font-size: 0.85rem; color: var(--muted);">
                取得した投稿動画ごとのサマリーデータです。再生数・エンゲージメントの比較に役立ちます。
              </p>
            </div>
          </section>

          <section class="card card--note" aria-labelledby="next">
            <h2 class="note__title" id="next">次にやること</h2>
            <ul class="note__list">
              <li>バックエンドでトークンを暗号化し、保存先を決定する。</li>
              <li>TikTok API を用いて動画インサイトを取得し、分析ダッシュボードへ連携する。</li>
              <li>不要になったトークンは <code>/oauth/revoke</code> 等で失効処理を行う。</li>
            </ul>
            <div class="actions">
              <a class="back-link" href="/" aria-label="トップに戻る">
                ← トップに戻る
              </a>
            </div>
          </section>
        </div>
      </main>
    </div>
    <script>
      (function () {
        const detailedGrid = document.getElementById("insights-detailed-grid");
        const detailedEmpty = document.getElementById("insights-detailed-empty");
        const tableBody = document.getElementById("insights-table-body");

        if (!detailedGrid || !detailedEmpty || !tableBody) {
          return;
        }

        const numberFormatter = new Intl.NumberFormat("ja-JP");
        const dateFormatter = new Intl.DateTimeFormat("ja-JP", {
          year: "numeric",
          month: "2-digit",
          day: "2-digit"
        });

        const formatNumber = (value) => {
          const numeric = Number(value);
          if (!Number.isFinite(numeric)) {
            return "–";
          }
          return numberFormatter.format(numeric);
        };

        const formatDate = (unixSeconds) => {
          if (!unixSeconds) {
            return "日時不明";
          }
          const date = new Date(Number(unixSeconds) * 1000);
          if (Number.isNaN(date.getTime())) {
            return "日時不明";
          }
          return dateFormatter.format(date);
        };

        const createStatChip = (label, value) => {
          const chip = document.createElement("span");
          chip.className = "stat-chip";

          const strong = document.createElement("span");
          strong.className = "stat-chip__label";
          strong.textContent = label;

          const span = document.createElement("span");
          span.textContent = value;

          chip.appendChild(strong);
          chip.appendChild(span);
          return chip;
        };

        const placeholders = [
          "/docs/responce_samples/images/placeholder-01.png",
          "/docs/responce_samples/images/placeholder-02.png",
          "/docs/responce_samples/images/placeholder-03.png"
        ];

        const getPlaceholder = (index) => {
          if (placeholders.length === 0) {
            return "";
          }
          return placeholders[index % placeholders.length];
        };

        const renderDetailedVideos = (videos) => {
          detailedGrid.innerHTML = "";
          tableBody.innerHTML = "";

          if (!Array.isArray(videos) || videos.length === 0) {
            detailedEmpty.textContent = "動画インサイトが見つかりませんでした。";
            detailedEmpty.hidden = false;
            const row = document.createElement("tr");
            const cell = document.createElement("td");
            cell.colSpan = 7;
            cell.style.padding = "1rem";
            cell.style.textAlign = "center";
            cell.style.color = "var(--muted)";
            cell.textContent = "動画データが存在しません。";
            row.appendChild(cell);
            tableBody.appendChild(row);
            return;
          }

          detailedEmpty.hidden = true;

          videos.forEach((video, index) => {
            const card = document.createElement("article");
            card.className = "video-card";

            const img = document.createElement("img");
            img.className = "video-card__thumb";
            img.src = getPlaceholder(index);
            img.alt = video.title ? video.title + " のサムネイル" : "動画サムネイル";
            card.appendChild(img);

            const body = document.createElement("div");
            body.className = "video-card__body";

            const title = document.createElement("h3");
            title.className = "video-card__title";
            title.textContent = video.title || "タイトル未設定";
            body.appendChild(title);

            const meta = document.createElement("p");
            meta.className = "video-card__meta";
            const duration = Number(video.duration);
            const durationText = Number.isFinite(duration) ? `${duration}秒` : "秒数不明";
            meta.textContent = [durationText, formatDate(video.create_time)].join(" ・ ");
            body.appendChild(meta);

            const stats = document.createElement("div");
            stats.className = "video-card__stats";
            stats.appendChild(createStatChip("Views", formatNumber(video.view_count)));
            stats.appendChild(createStatChip("Likes", formatNumber(video.like_count)));
            stats.appendChild(createStatChip("Comments", formatNumber(video.comment_count)));
            stats.appendChild(createStatChip("Shares", formatNumber(video.share_count)));
            body.appendChild(stats);

            const id = document.createElement("p");
            id.className = "video-card__id";
            id.textContent = video.id ? "ID: " + video.id : "ID: (不明)";
            body.appendChild(id);

            card.appendChild(body);
            detailedGrid.appendChild(card);

            const row = document.createElement("tr");

            const thumbCell = document.createElement("td");
            const thumbImg = document.createElement("img");
            thumbImg.className = "metrics-table__thumb";
            thumbImg.src = getPlaceholder(index);
            thumbImg.alt = video.title ? video.title + " のサムネイル" : "動画サムネイル";
            thumbCell.appendChild(thumbImg);
            row.appendChild(thumbCell);

            const titleCell = document.createElement("td");
            titleCell.textContent = video.title || "タイトル未設定";
            row.appendChild(titleCell);

            const durationCell = document.createElement("td");
            durationCell.textContent = Number.isFinite(Number(video.duration))
              ? `${Number(video.duration)}秒`
              : "秒数不明";
            row.appendChild(durationCell);

            const viewsCell = document.createElement("td");
            viewsCell.className = "metrics-table__numeric";
            viewsCell.textContent = formatNumber(video.view_count);
            row.appendChild(viewsCell);

            const likesCell = document.createElement("td");
            likesCell.className = "metrics-table__numeric";
            likesCell.textContent = formatNumber(video.like_count);
            row.appendChild(likesCell);

            const commentsCell = document.createElement("td");
            commentsCell.className = "metrics-table__numeric";
            commentsCell.textContent = formatNumber(video.comment_count);
            row.appendChild(commentsCell);

            const shareCell = document.createElement("td");
            shareCell.className = "metrics-table__numeric";
            shareCell.textContent = formatNumber(video.share_count);
            row.appendChild(shareCell);

            tableBody.appendChild(row);
          });
        };

        const handleDetailedError = (message) => {
          detailedEmpty.textContent = message;
          detailedEmpty.hidden = false;
        };

        const fetchJson = (path, onSuccess, onError) => {
          fetch(path, { headers: { Accept: "application/json" } })
            .then((response) => {
              if (!response.ok) {
                throw new Error("HTTP " + response.status);
              }
              return response.json();
            })
            .then(onSuccess)
            .catch((error) => {
              console.error("Failed to load mock data:", error);
              onError("データの読み込みに失敗しました。時間をおいて再度お試しください。");
            });
        };

        fetchJson(
          "/docs/responce_samples/mock_tiktok_videos.json",
          (payload) => {
            const videos = payload && payload.data && payload.data.videos;
            renderDetailedVideos(videos);
          },
          handleDetailedError
        );
      })();
    </script>
  </body>
</html>
